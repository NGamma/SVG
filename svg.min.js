/* SVG (c) Robby Kraft, MIT License */
(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.SVG={})})(this,function(a){"use strict";var d=Math.sqrt,e=Math.sin,f=Math.cos;function b(a,b){var c=a.replace(/>\s{0,}</g,"><").replace(/</g,"~::~<").replace(/\s*xmlns\:/g,"~::~xmlns:").split("~::~"),d=c.length,e=!1,f=0,g="",h=null!=b&&"string"==typeof b?b:"\t",i=["\n"];for(let c=0;100>c;c++)i.push(i[c]+h);for(let h=0;h<d;h++)-1<c[h].search(/<!/)?(g+=i[f]+c[h],e=!0,(-1<c[h].search(/-->/)||-1<c[h].search(/\]>/)||-1<c[h].search(/!DOCTYPE/))&&(e=!1)):-1<c[h].search(/-->/)||-1<c[h].search(/\]>/)?(g+=c[h],e=!1):/^<\w/.exec(c[h-1])&&/^<\/\w/.exec(c[h])&&/^<[\w:\-\.\,]+/.exec(c[h-1])==/^<\/[\w:\-\.\,]+/.exec(c[h])[0].replace("/","")?(g+=c[h],e||f--):-1<c[h].search(/<\w/)&&-1==c[h].search(/<\//)&&-1==c[h].search(/\/>/)?g=e?g+=c[h]:g+=i[f++]+c[h]:-1<c[h].search(/<\w/)&&-1<c[h].search(/<\//)?g=e?g+=c[h]:g+=i[f]+c[h]:-1<c[h].search(/<\//)?g=e?g+=c[h]:g+=i[--f]+c[h]:-1<c[h].search(/\/>/)?g=e?g+=c[h]:g+=i[f]+c[h]:-1<c[h].search(/<\?/)?g+=i[f]+c[h]:-1<c[h].search(/xmlns\:/)||-1<c[h].search(/xmlns\=/)?(console.log("xmlns at level",f),g+=i[f]+c[h]):g+=c[h];return"\n"==g[0]?g.slice(1):g}function c(a){let b,c=X(a),d={};const e=function(a,b){if(null==b)return;0<b.length&&a.preventDefault();let d=c.getPointer();b.forEach(a=>a(d))},f=function(a){let b=d[W.move];c.didMove(a.clientX,a.clientY),e(a,b)},g=function(a){let b=d[W.end];c.didRelease(),e(a,b)},h=function(a){let c=d[W.scroll],g={deltaX:a.deltaX,deltaY:a.deltaY,deltaZ:a.deltaZ};g.position=w(b,a.clientX,a.clientY),g.x=g.position[0],g.y=g.position[1],null==c||(0<c.length&&a.preventDefault(),c.forEach(a=>a(g)))};let i,j,k;const l=function(a){null!=i&&clearInterval(j),i=a,null!=i&&(k=0,j=setInterval(()=>{let a={time:b.getCurrentTime(),frame:k++};i(a)},1e3/60))},m={mouseup:function(a){f(a);let b=d[W.end];c.didRelease(a.clientX,a.clientY),e(a,b)},mousedown:function(a){let b=d[W.begin];c.didPress(a.clientX,a.clientY),e(a,b)},mousemove:f,mouseleave:function(a){let b=d[W.leave];c.didMove(a.clientX,a.clientY),e(a,b)},mouseenter:function(a){let b=d[W.enter];c.didMove(a.clientX,a.clientY),e(a,b)},touchend:g,touchmove:function(a){let b=d[W.move],f=a.touches[0];null==f||(c.didMove(f.clientX,f.clientY),e(a,b))},touchstart:function(a){let b=d[W.begin],f=a.touches[0];null==f||(c.didPress(f.clientX,f.clientY),e(a,b))},touchcancel:g,wheel:h},n=function(a,b){if("function"!=typeof b)throw"must supply a function type to addEventListener";void 0===d[a]&&(d[a]=[]),d[a].push(b)},o=function(a){Object.keys(m).forEach(b=>a.addEventListener(b,m[b],!1)),l(i)},p=function(a){Object.keys(m).forEach(b=>a.removeEventListener(b,m[b],!1)),null!=i&&clearInterval(j)},q=function(a){null!=b&&p(b),b=a,c.node=b,Object.keys(W).map(a=>W[a]).forEach(a=>{Object.defineProperty(b,a,{set:function(b){n(a,b)}})}),Object.defineProperty(b,"animate",{set:function(a){l(a)}}),Object.defineProperty(b,"mouse",{get:function(){return c.getPointer()}}),Object.defineProperty(b,"pointer",{get:function(){return c.getPointer()}}),o(b)};return q(a),{setup:q,addEventListener:n,remove:function(){p(b)}}}const g=function(a){for(;a.lastChild;)a.removeChild(a.lastChild)},h=function(a){let b=parseInt(a.getAttributeNS(null,"width"));return null==b||isNaN(b)?a.getBoundingClientRect().width:b},i=function(a){let b=parseInt(a.getAttributeNS(null,"height"));return null==b||isNaN(b)?a.getBoundingClientRect().height:b},j=function(a){let b=a.getAttribute("class");return null==b?[]:b.split(" ").filter(a=>""!==a)},k=function(a,b){if(null!=a){let c=j(a).filter(a=>a!==b);return c.push(b),a.setAttributeNS(null,"class",c.join(" ")),a}},l=function(a,b){if(null!=a){let c=j(a).filter(a=>a!==b);return a.setAttributeNS(null,"class",c.join(" ")),a}},m=function(a,b){return a.setAttributeNS(null,"class",b),a},n=function(a,b){return a.setAttributeNS(null,"id",b),a},o=function(c,d="image.svg",e=!1){let f=document.createElement("a");if(e){let a=document.createElementNS("http://www.w3.org/2000/svg","style");a.setAttribute("type","text/css"),a.innerHTML=p(),c.appendChild(a)}let a=new window.XMLSerializer().serializeToString(c),g=b(a),h=new window.Blob([g],{type:"text/plain"});f.setAttribute("href",window.URL.createObjectURL(h)),f.setAttribute("download",d),document.body.appendChild(f),f.click(),f.remove()},p=function(){let a=[];for(let b,c=0;c<document.styleSheets.length;c++){b=document.styleSheets[c];try{let c="cssRules"in b?b.cssRules:b.rules;for(let b,d=0;d<c.length;d++)b=c[d],"cssText"in b?a.push(b.cssText):a.push(b.selectorText+" {\n"+b.style.cssText+"\n}\n")}catch(a){}}return a.join("\n")},q=new window.DOMParser().parseFromString("INVALID","text/xml").getElementsByTagName("parsererror")[0].namespaceURI,r=function(a,b){if("string"==typeof a||a instanceof String){let c=new window.DOMParser().parseFromString(a,"text/xml");if(0===c.getElementsByTagNameNS(q,"parsererror").length){let a=c.documentElement;return null!=b&&b(a),a}fetch(a).then(a=>a.text()).then(a=>new window.DOMParser().parseFromString(a,"text/xml")).then(a=>{let c=a.getElementsByTagName("svg");if(null==c||0===c.length)throw"error, valid XML found, but no SVG element";return null!=b&&b(c[0]),c[0]})}else if(a instanceof Document)return b(a),a},s=function(a,b,c,e,f,g=0){let h=e/1-e,d=[b-h-g,c-h-g,e+2*h+2*g,f+2*h+2*g].join(" ");a.setAttributeNS(null,"viewBox",d)},t=function(a){let b=a.getAttribute("viewBox");return null==b?void 0:b.split(" ").map(a=>parseFloat(a))},u=function(a,b,c=0,d=0){1e-8>b&&(b=.01);let e=a.createSVGMatrix().translate(c,d).scale(1/b).translate(-c,-d),f=t(a);null==f&&x(a);let g=a.createSVGPoint(),h=a.createSVGPoint();g.x=f[0],g.y=f[1],h.x=f[0]+f[2],h.y=f[1]+f[3];let i=g.matrixTransform(e),j=h.matrixTransform(e);s(a,i.x,i.y,j.x-i.x,j.y-i.y)},v=function(a,b,c){let d=t(a);null==d&&x(a),d[0]+=b,d[1]+=c,a.setAttributeNS(null,"viewBox",d.join(" "))},w=function(a,b,c){let d=a.createSVGPoint();d.x=b,d.y=c;let e=d.matrixTransform(a.getScreenCTM().inverse()),f=[e.x,e.y];return f.x=e.x,f.y=e.y,f},x=function(a){let b=a.getBoundingClientRect(),c=0==b.width?640:b.width,d=0==b.height?480:b.height;s(a,0,0,c,d)},z=function(a){a.removeChildren=function(){return g(a)},a.addClass=function(){return k(a,...arguments)},a.removeClass=function(){return l(a,...arguments)},a.setClass=function(){return m(a,...arguments)},a.setID=function(){return n(a,...arguments)}},A=function(a){a.setViewBox=function(){return s(a,...arguments)},a.getViewBox=function(){return t(a,...arguments)},a.scaleViewBox=function(){return u(a,...arguments)},a.translateViewBox=function(){return v(a,...arguments)},a.convertToViewBox=function(){return w(a,...arguments)}},B=function(a,b){Object.keys(b).forEach(c=>{a[c]=function(){let d=b[c](...arguments);return a.appendChild(d),d}})},C="http://www.w3.org/2000/svg",D=function(a,b,c,d){let e=document.createElementNS(C,"line");return a&&e.setAttributeNS(null,"x1",a),b&&e.setAttributeNS(null,"y1",b),c&&e.setAttributeNS(null,"x2",c),d&&e.setAttributeNS(null,"y2",d),z(e),e},E=function(a,b,c){let d=document.createElementNS(C,"circle");return a&&d.setAttributeNS(null,"cx",a),b&&d.setAttributeNS(null,"cy",b),c&&d.setAttributeNS(null,"r",c),z(d),d},F=function(a,b,c,d){let e=document.createElementNS(C,"ellipse");return a&&e.setAttributeNS(null,"cx",a),b&&e.setAttributeNS(null,"cy",b),c&&e.setAttributeNS(null,"rx",c),d&&e.setAttributeNS(null,"ry",d),z(e),e},G=function(a,b,c,d){let e=document.createElementNS(C,"rect");return a&&e.setAttributeNS(null,"x",a),b&&e.setAttributeNS(null,"y",b),c&&e.setAttributeNS(null,"width",c),d&&e.setAttributeNS(null,"height",d),z(e),e},H=function(a){let b=document.createElementNS(C,"polygon");return N(b,a),z(b),b},I=function(a){let b=document.createElementNS(C,"polyline");return N(b,a),z(b),b},J=function(a,b,c,d,e,f,g,h){let i=document.createElementNS(C,"path");return i.setAttributeNS(null,"d","M "+a+","+b+" C "+c+","+d+" "+e+","+f+" "+g+","+h),z(i),i},K=function(a,b,c){let d=document.createElementNS(C,"text");return d.innerHTML=a,d.setAttributeNS(null,"x",b),d.setAttributeNS(null,"y",c),z(d),d},L=function(a,b,c,d,e){let f=document.createElementNS(C,"path");return O(f,a,b,c,d,e,!0),z(f),f},M=function(a,b,c,d,e){let f=document.createElementNS(C,"path");return O(f,a,b,c,d,e,!1),z(f),f},N=function(a,b){if(null!=b&&b.constructor===Array){let c=b.map(a=>a.constructor===Array?a:[a.x,a.y]).reduce((a,b)=>a+b[0]+","+b[1]+" ","");a.setAttributeNS(null,"points",c)}},O=function(a,b,c,g,h,i,j=!1){let k=[b+f(h)*g,c+e(h)*g],l=[f(h)*g,e(h)*g],m=[f(i)*g,e(i)*g],n=[m[0]-l[0],m[1]-l[1]],o=l[0]*m[1]-l[1]*m[0],p=l[0]*m[0]+l[1]*m[1],q=0<Math.atan2(o,p)?0:1,r=j?"M "+b+","+c+" l "+l[0]+","+l[1]+" ":"M "+k[0]+","+k[1]+" ";r+=["a ",g,g,0,q,1,n[0],n[1]].join(" "),j&&(r+=" Z"),a.setAttributeNS(null,"d",r)},P=function(b,c,a,d){var g=Math.PI;let h=.5*(2*g/d),j=f(h)*a,i=Array.from(Array(d)).map((k,l)=>{let i=-2*g*l/d+h,a=b+j*e(i),m=c+j*f(i);return[a,m]});return H(i)},Q=function(a,b,c){let e={color:"#eb3",strokeWidth:.01,width:.025,length:.075,bend:.3,pinch:.618,padding:.5,side:-1,start:!1,end:!0};"object"==typeof c&&null!==c&&Object.assign(e,c);let f="stroke:none;fill:"+e.color+";",g="stroke:"+e.color+";fill:none;stroke-width:"+strokeWidth+";",h=[b[0]-a[0],b[1]-a[1]],i=[h[1],-h[0]],j=[a[0]+h[0]/2,a[1]+h[1]/2],k=[j[0]+i[0]*e.side*e.bend,j[1]+i[1]*e.side*e.bend],l=[k[0]-a[0],k[1]-a[1]],m=[k[0]-b[0],k[1]-b[1]],n=d(l[0]*l[0]+l[1]*l[1]),o=d(m[0]*m[0]+m[1]*m[1]),p=[l[0]/n,l[1]/n],q=[m[0]/o,m[1]/o],r=[a[0]+p[0]*e.length*((e.start?1:0)+e.padding),a[1]+p[1]*e.length*((e.start?1:0)+e.padding)],s=[b[0]+q[0]*e.length*((e.end?1:0)+e.padding),b[1]+q[1]*e.length*((e.end?1:0)+e.padding)],t=[r[0]+(k[0]-r[0])*e.pinch,r[1]+(k[1]-r[1])*e.pinch],u=[s[0]+(k[0]-s[0])*e.pinch,s[1]+(k[1]-s[1])*e.pinch],v=[-p[0],-p[1]],w=[-q[0],-q[1]],x=[v[1],-v[0]],y=[w[1],-w[0]],z=[[r[0]+x[0]*-e.width,r[1]+x[1]*-e.width],[r[0]+x[0]*e.width,r[1]+x[1]*e.width],[r[0]+v[0]*e.length,r[1]+v[1]*e.length]],A=[[s[0]+y[0]*-e.width,s[1]+y[1]*-e.width],[s[0]+y[0]*e.width,s[1]+y[1]*e.width],[s[0]+w[0]*e.length,s[1]+w[1]*e.length]],B=document.createElementNS("http://www.w3.org/2000/svg","g"),C=J(r[0],r[1],t[0],t[1],u[0],u[1],s[0],s[1]);if(C.setAttribute("style",g),e.start){let a=B.polygon(z);a.setAttribute("style",f),B.appendChild(a)}if(e.end){let a=B.polygon(A);a.setAttribute("style",f),B.appendChild(a)}return B},R="http://www.w3.org/2000/svg",S=function(){let a=document.createElementNS(R,"svg");return a.setAttribute("version","1.1"),a.setAttribute("xmlns",R),U(a),a},T=function(){let a=document.createElementNS(R,"g");return z(a),B(a,V),a},U=function(a){z(a),A(a),B(a,V)},V={line:D,circle:E,ellipse:F,rect:G,polygon:H,polyline:I,bezier:J,text:K,wedge:L,arc:M,group:T,arcArrow:Q,regularPolygon:P},W={begin:"onMouseDown",enter:"onMouseEnter",leave:"onMouseLeave",move:"onMouseMove",end:"onMouseUp",scroll:"onScroll"},X=function(a){let b=a,c=Object.create(null);Object.assign(c,{isPressed:!1,position:[0,0],pressed:[0,0],drag:[0,0],prev:[0,0],x:0,y:0});const d=function(a,d){c.position=w(b,a,d),c.x=c.position[0],c.y=c.position[1]},e=function(a,e){c.isPressed=!0,c.pressed=w(b,a,e),d(a,e)},f=function(){c.drag=[c.position[0]-c.pressed[0],c.position[1]-c.pressed[1]],c.drag.x=c.drag[0],c.drag.y=c.drag[1]};let g={};return Object.defineProperty(g,"getPointer",{value:function(){let a=c.position.slice();return Object.keys(c).filter(a=>"object"==typeof a).forEach(b=>a[b]=c[b].slice()),Object.keys(c).filter(a=>"object"!=typeof a).forEach(b=>a[b]=c[b]),Object.freeze(a)}}),Object.defineProperty(g,"didMove",{value:function(a,b){c.prev=c.position,d(a,b),c.isPressed&&f()}}),Object.defineProperty(g,"didPress",{value:e}),Object.defineProperty(g,"didRelease",{value:function(){c.isPressed=!1}}),Object.defineProperty(g,"node",{set:function(a){b=a}}),g},Y=function(a){let b=a.filter(a=>a instanceof HTMLElement).shift(),c=a.filter(b=>"string"==typeof b||b instanceof String).map(a=>document.getElementById(a)).shift();return null==b?null==c?document.body:c:b},Z=function(a,b){let c=b.filter(a=>!isNaN(a));if(2<=c.length)a.setAttributeNS(null,"width",c[0]),a.setAttributeNS(null,"height",c[1]),s(a,0,0,c[0],c[1]);else if(null==a.getAttribute("viewBox")){let b=a.getBoundingClientRect();s(a,0,0,b.width,b.height)}},$=function(a){Object.defineProperty(a,"w",{get:function(){return h(a)},set:function(b){a.setAttributeNS(null,"width",b)}}),Object.defineProperty(a,"h",{get:function(){return i(a)},set:function(b){a.setAttributeNS(null,"height",b)}}),a.getWidth=function(){return h(a)},a.getHeight=function(){return i(a)},a.setWidth=function(b){a.setAttributeNS(null,"width",b)},a.setHeight=function(b){a.setAttributeNS(null,"height",b)},a.save=function(b="image.svg"){return o(a,b)},a.load=function(b,d){r(b,function(b,e){let f=a.parentNode;null!=b&&(b.events=a.events,U(b),null==b.events?b.events=c(b):b.events.setup(b),$(b),null!=f&&f.insertBefore(b,a),a.remove(),a=b),null!=d&&d(a,e)})}},_=function(a,b){null==b&&(b={}),null==b.radius&&(b.radius=1),null==b.fill&&(b.fill="#000000");let e=E(0,0,b.radius);e.setAttribute("fill",b.fill);let c=[0,0],f=!1;null!=a&&a.appendChild(e);const g=function(a,b){c[0]=a,c[1]=b,e.setAttribute("cx",a),e.setAttribute("cy",b)};if("position"in b){let a=b.position;null==a[0]?null!=a.x&&g(a.x,a.y):g(...a)}const h=function(a){if(f){let b=i(a);g(b[0],b[1])}};let i=function(a){return a};return{circle:e,set position(a){null==a[0]?null!=a.x&&g(a.x,a.y):g(a[0],a[1])},get position(){return[...c]},onMouseUp:function(){f=!1},onMouseMove:h,distance:function(a){var b=Math.pow;return d(b(a[0]-c[0],2)+b(a[1]-c[1],2))},remove:function(){a.removeChild(e)},set positionDidUpdate(a){i=a},set selected(a){f=!0}}};a.svg=S,a.group=T,a.line=D,a.circle=E,a.ellipse=F,a.rect=G,a.polygon=H,a.polyline=I,a.bezier=J,a.text=K,a.wedge=L,a.arc=M,a.setPoints=N,a.setArc=O,a.regularPolygon=P,a.arcArrow=Q,a.setViewBox=s,a.getViewBox=t,a.scaleViewBox=u,a.translateViewBox=v,a.convertToViewBox=w,a.removeChildren=g,a.save=o,a.load=r,a.image=function(){let a=S(),b=Array.from(arguments);Z(a,b),$(a),a.events=c(a);const d=function(){Z(a,b),Y(b).appendChild(a),b.filter(a=>"function"==typeof a).forEach(a=>a())};return"loading"===document.readyState?document.addEventListener("DOMContentLoaded",d):d(),a},a.controls=function(a,b,c){null==c&&(c={}),null==c.parent&&(c.parent=a),null==c.radius&&(c.radius=1),null==c.fill&&(c.fill="#000000");let d,e=Array.from(Array(b)).map(()=>_(c.parent,c));const f=function(b){b.preventDefault();let c=w(a,b.clientX,b.clientY);0<e.length&&(d=e.map((a,b)=>({i:b,d:a.distance(c)})).sort((c,a)=>c.d-a.d).shift().i,e[d].selected=!0)},g=function(b){b.preventDefault();let c=b.touches[0];if(null==c)return;let f=w(a,c.clientX,c.clientY);0<e.length&&(d=e.map((a,b)=>({i:b,d:a.distance(f)})).sort((c,a)=>c.d-a.d).shift().i,e[d].selected=!0)},h=function(a){a.preventDefault(),e.forEach(a=>a.onMouseUp()),d=void 0};return a.addEventListener("touchstart",g,!1),a.addEventListener("touchend",h,!1),a.addEventListener("touchcancel",h,!1),a.addEventListener("touchmove",function(b){b.preventDefault();let c=b.touches[0];if(null==c)return;let d=w(a,c.clientX,c.clientY);e.forEach(a=>a.onMouseMove(d))},!1),a.addEventListener("mousedown",f,!1),a.addEventListener("mouseup",function(a){a.preventDefault(),e.forEach(a=>a.onMouseUp()),d=void 0},!1),a.addEventListener("mousemove",function(b){b.preventDefault();let c=w(a,b.clientX,b.clientY);e.forEach(a=>a.onMouseMove(c))},!1),Object.defineProperty(e,"selectedIndex",{get:function(){return d}}),Object.defineProperty(e,"selected",{get:function(){return e[d]}}),Object.defineProperty(e,"removeAll",{value:function(){e.forEach(a=>a.remove()),e.splice(0,e.length),d=void 0}}),Object.defineProperty(e,"add",{value:function(b){e.push(_(a,b))}}),e},Object.defineProperty(a,"__esModule",{value:!0})});
